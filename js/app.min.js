!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.async=a.async||{})}(this,function(a){"use strict";function b(a,b){b|=0;for(var c=Math.max(a.length-b,0),d=Array(c),e=0;e<c;e++)d[e]=a[b+e];return d}function c(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function d(a){setTimeout(a,0)}function e(a){return function(c){var d=b(arguments,1);a(function(){c.apply(null,d)})}}function f(a){return cb(function(b,d){var e;try{e=a.apply(this,b)}catch(a){return d(a)}c(e)&&"function"==typeof e.then?e.then(function(a){g(d,null,a)},function(a){g(d,a.message?a:new Error(a))}):d(null,e)})}function g(a,b,c){try{a(b,c)}catch(a){fb(h,a)}}function h(a){throw a}function i(a){return gb&&"AsyncFunction"===a[Symbol.toStringTag]}function j(a){return i(a)?f(a):a}function k(a){return function(c){var d=b(arguments,1),e=cb(function(b,d){var e=this;return a(c,function(a,c){j(a).apply(e,b.concat(c))},d)});return d.length?e.apply(this,d):e}}function l(a){var b=mb.call(a,ob),c=a[ob];try{a[ob]=void 0;var d=!0}catch(a){}var e=nb.call(a);return d&&(b?a[ob]=c:delete a[ob]),e}function m(a){return qb.call(a)}function n(a){return null==a?void 0===a?sb:rb:(a=Object(a),tb&&tb in a?l(a):m(a))}function o(a){if(!c(a))return!1;var b=n(a);return b==vb||b==wb||b==ub||b==xb}function p(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=yb}function q(a){return null!=a&&p(a.length)&&!o(a)}function r(){}function s(a){return function(){if(null!==a){var b=a;a=null,b.apply(this,arguments)}}}function t(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function u(a){return null!=a&&"object"==typeof a}function v(a){return u(a)&&n(a)==Cb}function w(){return!1}function x(a,b){return!!(b=null==b?Ob:b)&&("number"==typeof a||Pb.test(a))&&a>-1&&a%1==0&&a<b}function y(a){return u(a)&&p(a.length)&&!!Qb[n(a)]}function z(a,b){var c=Hb(a),d=!c&&Gb(a),e=!c&&!d&&Nb(a),f=!c&&!d&&!e&&Xb(a),g=c||d||e||f,h=g?t(a.length,String):[],i=h.length;for(var j in a)!b&&!Zb.call(a,j)||g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||x(j,i))||h.push(j);return h}function A(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||$b)}function B(a){if(!A(a))return _b(a);var b=[];for(var c in Object(a))bc.call(a,c)&&"constructor"!=c&&b.push(c);return b}function C(a){return q(a)?z(a):B(a)}function D(a){var b=-1,c=a.length;return function(){return++b<c?{value:a[b],key:b}:null}}function E(a){var b=-1;return function(){var c=a.next();return c.done?null:(b++,{value:c.value,key:b})}}function F(a){var b=C(a),c=-1,d=b.length;return function(){var e=b[++c];return c<d?{value:a[e],key:e}:null}}function G(a){if(q(a))return D(a);var b=Bb(a);return b?E(b):F(a)}function H(a){return function(){if(null===a)throw new Error("Callback was already called.");var b=a;a=null,b.apply(this,arguments)}}function I(a){return function(b,c,d){function e(a,b){if(i-=1,a)h=!0,d(a);else{if(b===zb||h&&i<=0)return h=!0,d(null);f()}}function f(){for(;i<a&&!h;){var b=g();if(null===b)return h=!0,void(i<=0&&d(null));i+=1,c(b.value,b.key,H(e))}}if(d=s(d||r),a<=0||!b)return d(null);var g=G(b),h=!1,i=0;f()}}function J(a,b,c,d){I(b)(a,j(c),d)}function K(a,b){return function(c,d,e){return a(c,b,d,e)}}function L(a,b,c){function d(a,b){a?c(a):++f!==g&&b!==zb||c(null)}c=s(c||r);var e=0,f=0,g=a.length;for(0===g&&c(null);e<g;e++)b(a[e],e,H(d))}function M(a){return function(b,c,d){return a(dc,b,j(c),d)}}function N(a,b,c,d){d=d||r,b=b||[];var e=[],f=0,g=j(c);a(b,function(a,b,c){var d=f++;g(a,function(a,b){e[d]=b,c(a)})},function(a){d(a,e)})}function O(a){return function(b,c,d,e){return a(I(c),b,j(d),e)}}function P(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&!1!==b(a[c],c,a););return a}function Q(a,b){return a&&kc(a,b,C)}function R(a,b,c,d){for(var e=a.length,f=c+(d?1:-1);d?f--:++f<e;)if(b(a[f],f,a))return f;return-1}function S(a){return a!==a}function T(a,b,c){for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function U(a,b,c){return b===b?T(a,b,c):R(a,S,c)}function V(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function W(a){return"symbol"==typeof a||u(a)&&n(a)==mc}function X(a){if("string"==typeof a)return a;if(Hb(a))return V(a,X)+"";if(W(a))return pc?pc.call(a):"";var b=a+"";return"0"==b&&1/a==-nc?"-0":b}function Y(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),c=c>e?e:c,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function Z(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:Y(a,b,c)}function $(a,b){for(var c=a.length;c--&&U(b,a[c],0)>-1;);return c}function _(a,b){for(var c=-1,d=a.length;++c<d&&U(b,a[c],0)>-1;);return c}function aa(a){return a.split("")}function ba(a){return qc.test(a)}function ca(a){return a.match(zc)||[]}function da(a){return ba(a)?ca(a):aa(a)}function ea(a){return null==a?"":X(a)}function fa(a,b,c){if((a=ea(a))&&(c||void 0===b))return a.replace(Ac,"");if(!a||!(b=X(b)))return a;var d=da(a),e=da(b);return Z(d,_(d,e),$(d,e)+1).join("")}function ga(a){return a=a.toString().replace(Ec,""),a=a.match(Bc)[2].replace(" ",""),a=a?a.split(Cc):[],a=a.map(function(a){return fa(a.replace(Dc,""))})}function ha(a,b){var c={};Q(a,function(a,b){function d(b,c){var d=V(e,function(a){return b[a]});d.push(c),j(a).apply(null,d)}var e,f=i(a),g=!f&&1===a.length||f&&0===a.length;if(Hb(a))e=a.slice(0,-1),a=a[a.length-1],c[b]=e.concat(e.length>0?d:a);else if(g)c[b]=a;else{if(e=ga(a),0===a.length&&!f&&0===e.length)throw new Error("autoInject task functions require explicit parameters.");f||e.pop(),c[b]=e.concat(d)}}),lc(c,b)}function ia(){this.head=this.tail=null,this.length=0}function ja(a,b){a.length=1,a.head=a.tail=b}function ka(a,b,c){function d(a,b,c){if(null!=c&&"function"!=typeof c)throw new Error("task callback must be a function");if(k.started=!0,Hb(a)||(a=[a]),0===a.length&&k.idle())return fb(function(){k.drain()});for(var d=0,e=a.length;d<e;d++){var f={data:a[d],callback:c||r};b?k._tasks.unshift(f):k._tasks.push(f)}fb(k.process)}function e(a){return function(b){g-=1;for(var c=0,d=a.length;c<d;c++){var e=a[c],f=U(h,e,0);f>=0&&h.splice(f,1),e.callback.apply(e,arguments),null!=b&&k.error(b,e.data)}g<=k.concurrency-k.buffer&&k.unsaturated(),k.idle()&&k.drain(),k.process()}}if(null==b)b=1;else if(0===b)throw new Error("Concurrency must not be zero");var f=j(a),g=0,h=[],i=!1,k={_tasks:new ia,concurrency:b,payload:c,saturated:r,unsaturated:r,buffer:b/4,empty:r,drain:r,error:r,started:!1,paused:!1,push:function(a,b){d(a,!1,b)},kill:function(){k.drain=r,k._tasks.empty()},unshift:function(a,b){d(a,!0,b)},remove:function(a){k._tasks.remove(a)},process:function(){if(!i){for(i=!0;!k.paused&&g<k.concurrency&&k._tasks.length;){var a=[],b=[],c=k._tasks.length;k.payload&&(c=Math.min(c,k.payload));for(var d=0;d<c;d++){var j=k._tasks.shift();a.push(j),h.push(j),b.push(j.data)}g+=1,0===k._tasks.length&&k.empty(),g===k.concurrency&&k.saturated();var l=H(e(a));f(b,l)}i=!1}},length:function(){return k._tasks.length},running:function(){return g},workersList:function(){return h},idle:function(){return k._tasks.length+g===0},pause:function(){k.paused=!0},resume:function(){!1!==k.paused&&(k.paused=!1,fb(k.process))}};return k}function la(a,b){return ka(a,1,b)}function ma(a,b,c,d){d=s(d||r);var e=j(c);Gc(a,function(a,c,d){e(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})}function na(){var a=V(arguments,j);return function(){var c=b(arguments),d=this,e=c[c.length-1];"function"==typeof e?c.pop():e=r,ma(a,c,function(a,c,e){c.apply(d,a.concat(function(a){var c=b(arguments,1);e(a,c)}))},function(a,b){e.apply(d,[a].concat(b))})}}function oa(a){return a}function pa(a,b){return function(c,d,e,f){f=f||r;var g,h=!1;c(d,function(c,d,f){e(c,function(d,e){d?f(d):a(e)&&!g?(h=!0,g=b(!0,c),f(null,zb)):f()})},function(a){a?f(a):f(null,h?g:b(!1))})}}function qa(a,b){return b}function ra(a){return function(c){var d=b(arguments,1);d.push(function(c){var d=b(arguments,1);"object"==typeof console&&(c?console.error&&console.error(c):console[a]&&P(d,function(b){console[a](b)}))}),j(c).apply(null,d)}}function sa(a,c,d){function e(a){if(a)return d(a);var c=b(arguments,1);c.push(f),h.apply(this,c)}function f(a,b){return a?d(a):b?void g(e):d(null)}d=H(d||r);var g=j(a),h=j(c);f(null,!0)}function ta(a,c,d){d=H(d||r);var e=j(a),f=function(a){if(a)return d(a);var g=b(arguments,1);if(c.apply(this,g))return e(f);d.apply(null,[null].concat(g))};e(f)}function ua(a,b,c){ta(a,function(){return!b.apply(this,arguments)},c)}function va(a,b,c){function d(a){if(a)return c(a);g(e)}function e(a,b){return a?c(a):b?void f(d):c(null)}c=H(c||r);var f=j(b),g=j(a);g(e)}function wa(a){return function(b,c,d){return a(b,d)}}function xa(a,b,c){dc(a,wa(j(b)),c)}function ya(a,b,c,d){I(b)(a,wa(j(c)),d)}function za(a){return i(a)?a:cb(function(b,c){var d=!0;b.push(function(){var a=arguments;d?fb(function(){c.apply(null,a)}):c.apply(null,a)}),a.apply(this,b),d=!1})}function Aa(a){return!a}function Ba(a){return function(b){return null==b?void 0:b[a]}}function Ca(a,b,c,d){var e=new Array(b.length);a(b,function(a,b,d){c(a,function(a,c){e[b]=!!c,d(a)})},function(a){if(a)return d(a);for(var c=[],f=0;f<b.length;f++)e[f]&&c.push(b[f]);d(null,c)})}function Da(a,b,c,d){var e=[];a(b,function(a,b,d){c(a,function(c,f){c?d(c):(f&&e.push({index:b,value:a}),d())})},function(a){a?d(a):d(null,V(e.sort(function(a,b){return a.index-b.index}),Ba("value")))})}function Ea(a,b,c,d){(q(b)?Ca:Da)(a,b,j(c),d||r)}function Fa(a,b){function c(a){if(a)return d(a);e(c)}var d=H(b||r),e=j(za(a));c()}function Ga(a,b,c,d){d=s(d||r);var e={},f=j(c);J(a,b,function(a,b,c){f(a,b,function(a,d){if(a)return c(a);e[b]=d,c()})},function(a){d(a,e)})}function Ha(a,b){return b in a}function Ia(a,c){var d=Object.create(null),e=Object.create(null);c=c||oa;var f=j(a),g=cb(function(a,g){var h=c.apply(null,a);Ha(d,h)?fb(function(){g.apply(null,d[h])}):Ha(e,h)?e[h].push(g):(e[h]=[g],f.apply(null,a.concat(function(){var a=b(arguments);d[h]=a;var c=e[h];delete e[h];for(var f=0,g=c.length;f<g;f++)c[f].apply(null,a)})))});return g.memo=d,g.unmemoized=a,g}function Ja(a,c,d){d=d||r;var e=q(c)?[]:{};a(c,function(a,c,d){j(a)(function(a,f){arguments.length>2&&(f=b(arguments,1)),e[c]=f,d(a)})},function(a){d(a,e)})}function Ka(a,b){Ja(dc,a,b)}function La(a,b,c){Ja(I(b),a,c)}function Ma(a,b){if(b=s(b||r),!Hb(a))return b(new TypeError("First argument to race must be an array of functions"));if(!a.length)return b();for(var c=0,d=a.length;c<d;c++)j(a[c])(b)}function Na(a,c,d,e){ma(b(a).reverse(),c,d,e)}function Oa(a){var c=j(a);return cb(function(a,d){return a.push(function(a,c){if(a)d(null,{error:a});else{var e;e=arguments.length<=2?c:b(arguments,1),d(null,{value:e})}}),c.apply(this,a)})}function Pa(a,b,c,d){Ea(a,b,function(a,b){c(a,function(a,c){b(a,!c)})},d)}function Qa(a){var b;return Hb(a)?b=V(a,Oa):(b={},Q(a,function(a,c){b[c]=Oa.call(this,a)})),b}function Ra(a){return function(){return a}}function Sa(a,b,c){function d(){h(function(a){a&&i++<g.times&&("function"!=typeof g.errorFilter||g.errorFilter(a))?setTimeout(d,g.intervalFunc(i)):c.apply(null,arguments)})}var e=5,f=0,g={times:e,intervalFunc:Ra(f)};if(arguments.length<3&&"function"==typeof a?(c=b||r,b=a):(!function(a,b){if("object"==typeof b)a.times=+b.times||e,a.intervalFunc="function"==typeof b.interval?b.interval:Ra(+b.interval||f),a.errorFilter=b.errorFilter;else{if("number"!=typeof b&&"string"!=typeof b)throw new Error("Invalid arguments for async.retry");a.times=+b||e}}(g,a),c=c||r),"function"!=typeof b)throw new Error("Invalid arguments for async.retry");var h=j(b),i=1;d()}function Ta(a,b){Ja(Gc,a,b)}function Ua(a,b,c){function d(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}var e=j(b);ec(a,function(a,b){e(a,function(c,d){if(c)return b(c);b(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);c(null,V(b.sort(d),Ba("value")))})}function Va(a,b,c){var d=j(a);return cb(function(e,f){function g(){var b=a.name||"anonymous",d=new Error('Callback function "'+b+'" timed out.');d.code="ETIMEDOUT",c&&(d.info=c),i=!0,f(d)}var h,i=!1;e.push(function(){i||(f.apply(null,arguments),clearTimeout(h))}),h=setTimeout(g,b),d.apply(null,e)})}function Wa(a,b,c,d){for(var e=-1,f=nd(md((b-a)/(c||1)),0),g=Array(f);f--;)g[d?f:++e]=a,a+=c;return g}function Xa(a,b,c,d){var e=j(c);gc(Wa(0,a,1),b,e,d)}function Ya(a,b,c,d){arguments.length<=3&&(d=c,c=b,b=Hb(a)?[]:{}),d=s(d||r);var e=j(c);dc(a,function(a,c,d){e(b,a,c,d)},function(a){d(a,b)})}function Za(a,c){var d,e=null;c=c||r,Rc(a,function(a,c){j(a)(function(a,f){d=arguments.length>2?b(arguments,1):f,e=a,c(!a)})},function(){c(e,d)})}function $a(a){return function(){return(a.unmemoized||a).apply(null,arguments)}}function _a(a,c,d){d=H(d||r);var e=j(c);if(!a())return d(null);var f=function(c){if(c)return d(c);if(a())return e(f);var g=b(arguments,1);d.apply(null,[null].concat(g))};e(f)}function ab(a,b,c){_a(function(){return!a.apply(this,arguments)},b,c)}var bb,cb=function(a){return function(){var c=b(arguments),d=c.pop();a.call(this,c,d)}},db="function"==typeof setImmediate&&setImmediate,eb="object"==typeof process&&"function"==typeof process.nextTick;bb=db?setImmediate:eb?process.nextTick:d;var fb=e(bb),gb="function"==typeof Symbol,hb="object"==typeof global&&global&&global.Object===Object&&global,ib="object"==typeof self&&self&&self.Object===Object&&self,jb=hb||ib||Function("return this")(),kb=jb.Symbol,lb=Object.prototype,mb=lb.hasOwnProperty,nb=lb.toString,ob=kb?kb.toStringTag:void 0,pb=Object.prototype,qb=pb.toString,rb="[object Null]",sb="[object Undefined]",tb=kb?kb.toStringTag:void 0,ub="[object AsyncFunction]",vb="[object Function]",wb="[object GeneratorFunction]",xb="[object Proxy]",yb=9007199254740991,zb={},Ab="function"==typeof Symbol&&Symbol.iterator,Bb=function(a){return Ab&&a[Ab]&&a[Ab]()},Cb="[object Arguments]",Db=Object.prototype,Eb=Db.hasOwnProperty,Fb=Db.propertyIsEnumerable,Gb=v(function(){return arguments}())?v:function(a){return u(a)&&Eb.call(a,"callee")&&!Fb.call(a,"callee")},Hb=Array.isArray,Ib="object"==typeof a&&a&&!a.nodeType&&a,Jb=Ib&&"object"==typeof module&&module&&!module.nodeType&&module,Kb=Jb&&Jb.exports===Ib,Lb=Kb?jb.Buffer:void 0,Mb=Lb?Lb.isBuffer:void 0,Nb=Mb||w,Ob=9007199254740991,Pb=/^(?:0|[1-9]\d*)$/,Qb={};Qb["[object Float32Array]"]=Qb["[object Float64Array]"]=Qb["[object Int8Array]"]=Qb["[object Int16Array]"]=Qb["[object Int32Array]"]=Qb["[object Uint8Array]"]=Qb["[object Uint8ClampedArray]"]=Qb["[object Uint16Array]"]=Qb["[object Uint32Array]"]=!0,Qb["[object Arguments]"]=Qb["[object Array]"]=Qb["[object ArrayBuffer]"]=Qb["[object Boolean]"]=Qb["[object DataView]"]=Qb["[object Date]"]=Qb["[object Error]"]=Qb["[object Function]"]=Qb["[object Map]"]=Qb["[object Number]"]=Qb["[object Object]"]=Qb["[object RegExp]"]=Qb["[object Set]"]=Qb["[object String]"]=Qb["[object WeakMap]"]=!1;var Rb="object"==typeof a&&a&&!a.nodeType&&a,Sb=Rb&&"object"==typeof module&&module&&!module.nodeType&&module,Tb=Sb&&Sb.exports===Rb,Ub=Tb&&hb.process,Vb=function(){try{return Ub&&Ub.binding("util")}catch(a){}}(),Wb=Vb&&Vb.isTypedArray,Xb=Wb?function(a){return function(b){return a(b)}}(Wb):y,Yb=Object.prototype,Zb=Yb.hasOwnProperty,$b=Object.prototype,_b=function(a,b){return function(c){return a(b(c))}}(Object.keys,Object),ac=Object.prototype,bc=ac.hasOwnProperty,cc=K(J,1/0),dc=function(a,b,c){(q(a)?L:cc)(a,j(b),c)},ec=M(N),fc=k(ec),gc=O(N),hc=K(gc,1),ic=k(hc),jc=function(a){var c=b(arguments,1);return function(){var d=b(arguments);return a.apply(null,c.concat(d))}},kc=function(a){return function(b,c,d){for(var e=-1,f=Object(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(!1===c(f[i],i,f))break}return b}}(),lc=function(a,c,d){function e(a,b){t.push(function(){i(a,b)})}function f(){if(0===t.length&&0===o)return d(null,n);for(;t.length&&o<c;){t.shift()()}}function g(a,b){var c=q[a];c||(c=q[a]=[]),c.push(b)}function h(a){P(q[a]||[],function(a){a()}),f()}function i(a,c){if(!p){var e=H(function(c,e){if(o--,arguments.length>2&&(e=b(arguments,1)),c){var f={};Q(n,function(a,b){f[b]=a}),f[a]=e,p=!0,q=Object.create(null),d(c,f)}else n[a]=e,h(a)});o++;var f=j(c[c.length-1]);c.length>1?f(n,e):f(e)}}function k(b){var c=[];return Q(a,function(a,d){Hb(a)&&U(a,b,0)>=0&&c.push(d)}),c}"function"==typeof c&&(d=c,c=null),d=s(d||r);var l=C(a),m=l.length;if(!m)return d(null);c||(c=m);var n={},o=0,p=!1,q=Object.create(null),t=[],u=[],v={};Q(a,function(b,c){if(!Hb(b))return e(c,[b]),void u.push(c);var d=b.slice(0,b.length-1),f=d.length;if(0===f)return e(c,b),void u.push(c);v[c]=f,P(d,function(h){if(!a[h])throw new Error("async.auto task `"+c+"` has a non-existent dependency `"+h+"` in "+d.join(", "));g(h,function(){0===--f&&e(c,b)})})}),function(){for(var a,b=0;u.length;)a=u.pop(),b++,P(k(a),function(a){0==--v[a]&&u.push(a)});if(b!==m)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),f()},mc="[object Symbol]",nc=1/0,oc=kb?kb.prototype:void 0,pc=oc?oc.toString:void 0,qc=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),rc="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",sc="\\ud83c[\\udffb-\\udfff]",tc="(?:\\ud83c[\\udde6-\\uddff]){2}",uc="[\\ud800-\\udbff][\\udc00-\\udfff]",vc="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",wc="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",tc,uc].join("|")+")[\\ufe0e\\ufe0f]?"+vc+")*",xc="[\\ufe0e\\ufe0f]?"+vc+wc,yc="(?:"+["[^\\ud800-\\udfff]"+rc+"?",rc,tc,uc,"[\\ud800-\\udfff]"].join("|")+")",zc=RegExp(sc+"(?="+sc+")|"+yc+xc,"g"),Ac=/^\s+|\s+$/g,Bc=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,Cc=/,/,Dc=/(=.+)?(\s*)$/,Ec=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;ia.prototype.removeLink=function(a){return a.prev?a.prev.next=a.next:this.head=a.next,a.next?a.next.prev=a.prev:this.tail=a.prev,a.prev=a.next=null,this.length-=1,a},ia.prototype.empty=function(){for(;this.head;)this.shift();return this},ia.prototype.insertAfter=function(a,b){b.prev=a,b.next=a.next,a.next?a.next.prev=b:this.tail=b,a.next=b,this.length+=1},ia.prototype.insertBefore=function(a,b){b.prev=a.prev,b.next=a,a.prev?a.prev.next=b:this.head=b,a.prev=b,this.length+=1},ia.prototype.unshift=function(a){this.head?this.insertBefore(this.head,a):ja(this,a)},ia.prototype.push=function(a){this.tail?this.insertAfter(this.tail,a):ja(this,a)},ia.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ia.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ia.prototype.toArray=function(){for(var a=Array(this.length),b=this.head,c=0;c<this.length;c++)a[c]=b.data,b=b.next;return a},ia.prototype.remove=function(a){for(var b=this.head;b;){var c=b.next;a(b)&&this.removeLink(b),b=c}return this};var Fc,Gc=K(J,1),Hc=function(){return na.apply(null,b(arguments).reverse())},Ic=Array.prototype.concat,Jc=function(a,c,d,e){e=e||r;var f=j(d);gc(a,c,function(a,c){f(a,function(a){return a?c(a):c(null,b(arguments,1))})},function(a,b){for(var c=[],d=0;d<b.length;d++)b[d]&&(c=Ic.apply(c,b[d]));return e(a,c)})},Kc=K(Jc,1/0),Lc=K(Jc,1),Mc=function(){var a=b(arguments),c=[null].concat(a);return function(){return arguments[arguments.length-1].apply(this,c)}},Nc=M(pa(oa,qa)),Oc=O(pa(oa,qa)),Pc=K(Oc,1),Qc=ra("dir"),Rc=K(ya,1),Sc=M(pa(Aa,Aa)),Tc=O(pa(Aa,Aa)),Uc=K(Tc,1),Vc=M(Ea),Wc=O(Ea),Xc=K(Wc,1),Yc=function(a,b,c,d){d=d||r;var e=j(c);gc(a,b,function(a,b){e(a,function(c,d){return c?b(c):b(null,{key:d,val:a})})},function(a,b){for(var c={},e=Object.prototype.hasOwnProperty,f=0;f<b.length;f++)if(b[f]){var g=b[f].key,h=b[f].val;e.call(c,g)?c[g].push(h):c[g]=[h]}return d(a,c)})},Zc=K(Yc,1/0),$c=K(Yc,1),_c=ra("log"),ad=K(Ga,1/0),bd=K(Ga,1);Fc=eb?process.nextTick:db?setImmediate:d;var cd=e(Fc),dd=function(a,b){var c=j(a);return ka(function(a,b){c(a[0],b)},b,1)},ed=function(a,b){var c=dd(a,b);return c.push=function(a,b,d){if(null==d&&(d=r),"function"!=typeof d)throw new Error("task callback must be a function");if(c.started=!0,Hb(a)||(a=[a]),0===a.length)return fb(function(){c.drain()});b=b||0;for(var e=c._tasks.head;e&&b>=e.priority;)e=e.next;for(var f=0,g=a.length;f<g;f++){var h={data:a[f],priority:b,callback:d};e?c._tasks.insertBefore(e,h):c._tasks.push(h)}fb(c.process)},delete c.unshift,c},fd=M(Pa),gd=O(Pa),hd=K(gd,1),id=function(a,b){b||(b=a,a=null);var c=j(b);return cb(function(b,d){function e(a){c.apply(null,b.concat(a))}a?Sa(a,e,d):Sa(e,d)})},jd=M(pa(Boolean,oa)),kd=O(pa(Boolean,oa)),ld=K(kd,1),md=Math.ceil,nd=Math.max,od=K(Xa,1/0),pd=K(Xa,1),qd=function(a,c){function d(b){var c=j(a[f++]);b.push(H(e)),c.apply(null,b)}function e(e){if(e||f===a.length)return c.apply(null,arguments);d(b(arguments,1))}if(c=s(c||r),!Hb(a))return c(new Error("First argument to waterfall must be an array of functions"));if(!a.length)return c();var f=0;d([])},rd={applyEach:fc,applyEachSeries:ic,apply:jc,asyncify:f,auto:lc,autoInject:ha,cargo:la,compose:Hc,concat:Kc,concatLimit:Jc,concatSeries:Lc,constant:Mc,detect:Nc,detectLimit:Oc,detectSeries:Pc,dir:Qc,doDuring:sa,doUntil:ua,doWhilst:ta,during:va,each:xa,eachLimit:ya,eachOf:dc,eachOfLimit:J,eachOfSeries:Gc,eachSeries:Rc,ensureAsync:za,every:Sc,everyLimit:Tc,everySeries:Uc,filter:Vc,filterLimit:Wc,filterSeries:Xc,forever:Fa,groupBy:Zc,groupByLimit:Yc,groupBySeries:$c,log:_c,map:ec,mapLimit:gc,mapSeries:hc,mapValues:ad,mapValuesLimit:Ga,mapValuesSeries:bd,memoize:Ia,nextTick:cd,parallel:Ka,parallelLimit:La,priorityQueue:ed,queue:dd,race:Ma,reduce:ma,reduceRight:Na,reflect:Oa,reflectAll:Qa,reject:fd,rejectLimit:gd,rejectSeries:hd,retry:Sa,retryable:id,seq:na,series:Ta,setImmediate:fb,some:jd,someLimit:kd,someSeries:ld,sortBy:Ua,timeout:Va,times:od,timesLimit:Xa,timesSeries:pd,transform:Ya,tryEach:Za,unmemoize:$a,until:ab,waterfall:qd,whilst:_a,all:Sc,any:jd,forEach:xa,forEachSeries:Rc,forEachLimit:ya,forEachOf:dc,forEachOfSeries:Gc,forEachOfLimit:J,inject:ma,foldl:ma,foldr:Na,select:Vc,selectLimit:Wc,selectSeries:Xc,wrapSync:f};a.default=rd,a.applyEach=fc,a.applyEachSeries=ic,a.apply=jc,a.asyncify=f,a.auto=lc,a.autoInject=ha,a.cargo=la,a.compose=Hc,a.concat=Kc,a.concatLimit=Jc,a.concatSeries=Lc,a.constant=Mc,a.detect=Nc,a.detectLimit=Oc,a.detectSeries=Pc,a.dir=Qc,a.doDuring=sa,a.doUntil=ua,a.doWhilst=ta,a.during=va,a.each=xa,a.eachLimit=ya,a.eachOf=dc,a.eachOfLimit=J,a.eachOfSeries=Gc,a.eachSeries=Rc,a.ensureAsync=za,a.every=Sc,a.everyLimit=Tc,a.everySeries=Uc,a.filter=Vc,a.filterLimit=Wc,a.filterSeries=Xc,a.forever=Fa,a.groupBy=Zc,a.groupByLimit=Yc,a.groupBySeries=$c,a.log=_c,a.map=ec,a.mapLimit=gc,a.mapSeries=hc,a.mapValues=ad,a.mapValuesLimit=Ga,a.mapValuesSeries=bd,a.memoize=Ia,a.nextTick=cd,a.parallel=Ka,a.parallelLimit=La,a.priorityQueue=ed,a.queue=dd,a.race=Ma,a.reduce=ma,a.reduceRight=Na,a.reflect=Oa,a.reflectAll=Qa,a.reject=fd,a.rejectLimit=gd,a.rejectSeries=hd,a.retry=Sa,a.retryable=id,a.seq=na,a.series=Ta,a.setImmediate=fb,a.some=jd,a.someLimit=kd,a.someSeries=ld,a.sortBy=Ua,a.timeout=Va,a.times=od,a.timesLimit=Xa,a.timesSeries=pd,a.transform=Ya,a.tryEach=Za,a.unmemoize=$a,a.until=ab,a.waterfall=qd,a.whilst=_a,a.all=Sc,a.allLimit=Tc,a.allSeries=Uc,a.any=jd,a.anyLimit=kd,a.anySeries=ld,a.find=Nc,a.findLimit=Oc,a.findSeries=Pc,a.forEach=xa,a.forEachSeries=Rc,a.forEachLimit=ya,a.forEachOf=dc,a.forEachOfSeries=Gc,a.forEachOfLimit=J,a.inject=ma,a.foldl=ma,a.foldr=Na,a.select=Vc,a.selectLimit=Wc,a.selectSeries=Xc,a.wrapSync=f,Object.defineProperty(a,"__esModule",{value:!0})}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d){d=Object(d);for(var e=Object.keys(Object(d)),f=0,g=e.length;f<g;f++){var h=e[f],i=Object.getOwnPropertyDescriptor(d,h);void 0!==i&&i.enumerable&&(b[h]=d[h])}}}return b}}),String.prototype.compile=function(a){return this.replace(/[{]([^}]+)[}]/g,function(b,c){return a[c]})},function(a){a.fn.smartVideo=function(b){var c,d=Object.assign({autoSize:!0,chapters:[],events:[],onStart:!1,onPlay:!1,onPause:!1,onComplete:!1,hideControls:!1,hideChapterMenu:!1},b),e=this,f=e[0],g=document.createElement("canvas"),h=e.clone(!1,!1),i={ready:!1,init:function(){e.wrap("<div class='smart-video'></div>".compile({mode:d.mode})),c=e.closest(".smart-video"),c.prepend("<div class='loader'><i class='fa fa-spin fa-cog'></i></div>"),e.removeProp("controls"),e.prop("preload","metadata"),e.attr("playsinline",!0),e.attr("oncontextmenu","return false;"),d.autoSize&&i.resize(),e.after("<div class='control-bar'> <div class='inner'> <div class='controls'> <a class='fa fa-play' href='#'></a> <a class='fa fa-pause hide' href='#'></a> <a class='fa fa-volume-up' href='#'></a> </div> <div class='timecode'></div> <div class='progress'> <div class='inner'> <div class='bar'></div> </div> </div> </div> </div>"),e.after("<div class='chapter-menu'></div>"),e.after("<div class='event_code'><header><a class='fa fa-close close' href='#'></a></header><article></article><footer></footer></div>");e.after("<a class='fa fa-list-ul toggle' data-target='.chapter-menu' data-original-icon='fa-list-ul' href='#'></a>"),e.after("<a class='fa fa-toggle-off toggle' data-target='.control-bar' data-original-icon='fa-toggle-off' href='#'></a>"),i.ele={play:c.find(".fa-play"),pause:c.find(".fa-pause"),progressBar:c.find(".progress"),progress:c.find(".progress .bar"),chapterMenu:c.find(".chapter-menu"),controls:c.find(".control-bar"),timecode:c.find(".timecode"),event_code:c.find(".event_code")},i.binds()},resize:function(){var a=e.width(),b=.5625*a;e.height(b)},binds:function(){d.autoSize&&a(window).resize(i.resize),i.ele.play.on("click",function(a){a.preventDefault(),i.ready&&f.play()}),i.ele.pause.on("click",function(a){a.preventDefault(),i.ready&&f.pause()}),f.readyState>=2?i.playerSetup():e.on("loadedmetadata",i.playerSetup),e.on("click",function(a){i.toggleControls("show"),i.playing?f.pause():(f.play(),setTimeout(function(){i.toggleControls("hide")},1500))}),e.on("play playing",function(a){i.ele.play.addClass("hide"),i.ele.pause.removeClass("hide"),i.playing=!0,i.started||(i.toggleControls("hide"),i.toggleChapterMenu("hide"),i.started=!0,"function"==typeof d.onStart&&d.onStart(a)),"function"==typeof d.onPlay&&d.onPlay(a)}),e.on("pause",function(a){i.ele.play.removeClass("hide"),i.ele.pause.addClass("hide"),i.playing=!1,"function"==typeof d.onPause&&d.onPause(a)}),e.on("timeupdate",function(a){if(i.ready){var b=Math.floor(f.currentTime),c=f.duration,e=Math.floor(b/c*100),g=i.ele.chapterMenu.find("[data-seconds='{seconds}']".compile({seconds:Math.floor(b)}));i.ele.progress.width(e+"%"),i.ele.timecode.text(i.secondsToTimecode(parseInt(b))),g.length>0&&(i.ele.chapterMenu.find("a.chapter").removeClass("active"),g.addClass("active"));var h=d.events.filter(function(a){return a.seconds.start<=b&&a.seconds.end>=b})[0],j=d.events.indexOf(h);i.ele.event_code.removeClass("active"),h?(i.ele.event_code.removeAttr("class").addClass("event_code active").addClass(h.size).addClass(h.position).addClass(h.classes.join(" ")).data("id",j),i.ele.event_code.find("article").html(h.html)):i.ele.event_code.removeAttr("class").addClass("event_code")}}),e.on("ended",function(a){"function"==typeof d.onComplete&&d.onComplete(a)}),i.ele.progressBar.on("click mousedown mouseup",function(b){b.preventDefault();var c=a(this).offset(),d=b.pageX-c.left,e=a(this).width(),g=d/e,h=f.duration*g;f.currentTime=h}),a("body").on("click",".chapter-menu > a.chapter",function(b){b.preventDefault();var c=a(this),d=c.data("seconds"),e=c.closest(".smart-video"),f=e.find("video")[0];f.currentTime=d,f.play()}),a("body").on("click",".control-bar a.chapter",function(b){b.preventDefault();a(this);a(".control-bar a.chapter.active").removeClass("active"),i.ele.addClass("active")}),a("body").on("click",".toggle",function(b){b.preventDefault();var c=a(this),d=c.closest(".smart-video"),e=(d.find("video")[0],c.data("target"));c.data("original-icon"),d.find(e);switch(e){case".chapter-menu":i.toggleChapterMenu();break;case".control-bar":i.toggleControls()}}),a("body").on("click",".event_code .close",function(b){b.preventDefault();var c=a(this),e=c.closest(".event_code"),f=e.data("id");d.events[f].classes.push("hide"),e.addClass("hide")})},toggleChapterMenu:function(a){var b=c.find("[data-target='.chapter-menu']"),d=b.data("original-icon"),e=i.ele.chapterMenu;void 0===a&&(a=e.hasClass("active")?"hide":"show"),"show"===a?(e.addClass("active"),b.removeAttr("class").addClass("fa fa-close toggle")):(e.removeClass("active"),b.removeAttr("class").addClass("fa toggle").addClass(d))},toggleControls:function(a){var b=c.find("[data-target='.control-bar']"),d=b.data("original-icon"),e=i.ele.controls;void 0===a&&(a=e.hasClass("active")?"hide":"show"),"show"===a?(e.addClass("active"),b.removeAttr("class").addClass("fa fa-close toggle")):(e.removeClass("active"),b.removeAttr("class").addClass("fa toggle").addClass(d))},getFrame:function(a,b){var c=0,d=function(){g.width=.25*h[0].videoWidth,g.height=.25*h[0].videoHeight,h[0].currentTime=a};if(i.checkiOS()&&(i.checkiOS()[0]<10||i.checkiOS()[1]<3))return b(!1),!1;h[0].readyState>=2?d():h.on("loadedmetadata",d),h.on("seeked",function(){g.getContext("2d").drawImage(h[0],0,0,g.width,g.height),c<2?(c++,h[0].currentTime=a):(h.off("seeked"),"function"==typeof b&&b(g.toDataURL()))})},timecodeToSeconds:function(a){var b=a.split(":");return 3600*parseInt(b[0])+60*parseInt(b[1])+parseInt(b[2])},secondsToTimecode:function(a){var b=parseInt(a/3600),c=a%3600,d=parseInt(c/60),e=c%60;return"{hours}:{minutes}:{seconds}".compile({hours:i.zeroPad(b),minutes:i.zeroPad(d),seconds:i.zeroPad(e)})},zeroPad:function(a){return parseInt(a)<10?"0"+a:a},playerSetup:function(){var b=f.duration;a.each(d.events,function(a,c){c.seconds={},c.seconds.start=i.timecodeToSeconds(c.start),c.seconds.end=i.timecodeToSeconds(c.end),d.events[a]=Object.assign({seconds:{},start:"00:00:00",end:"00:00:00",classes:[],size:"quarter",html:"",position:"right"},c);var e=Math.floor(c.seconds.start/b*100);i.ele.progressBar.find(".inner").append("<a class='video_event' style='left: {pct}%;' href='#'></a>".compile({pct:e}))}),async.eachSeries(d.chapters,function(a,c){a.seconds=i.timecodeToSeconds(a.timecode);var d=Math.floor(a.seconds/b*100),e=function(b){i.ele.progressBar.find(".inner").append("<a class='chapter' style='left: {pct}%' data-seconds='{seconds}'><div class='preview'><img src='{thumbnail}' /></div></a>".compile({pct:d,seconds:a.seconds,thumbnail:b})),f.attr("data-seconds",a.seconds).html("<div class='preview'><img src='{thumbnail}' /></div><div class='headline'>{title}</div><div class='description'>{desc}</div>".compile({seconds:a.seconds,thumbnail:b,title:a.title,desc:a.description})),c()};i.ele.chapterMenu.append("<a class='chapter' href='#'></a>");var f=i.ele.chapterMenu.find(".chapter").eq(-1);a.thumbnail?e(a.thumbnail):i.getFrame(a.seconds,e)},function(a){f.currentTime=0,i.ready=!0,c.addClass("ready"),h.remove(),d.hideChapterMenu||i.toggleChapterMenu("show"),d.hideControls||i.toggleControls("show")})},checkiOS:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3]||0,10)]}return!1}};i.init()}}(jQuery),$(function(){$("video").smartVideo({autoPlay:!0,chapters:[{timecode:"00:00:01",title:"Chapter 1",description:"Look at the pretty colors!"},{timecode:"00:00:16",title:"Chapter 2",description:"Humor: Bird gets knocked out"},{timecode:"00:00:27",title:"Chapter 3: Title Screen",description:"This is where the title finally shows up."},{timecode:"00:00:41",title:"Chapter 4: The awakening",description:"Our hero awakens from his slumber"},{timecode:"00:00:56",title:"Chapter 5: Starting the day",description:"After a nice neck crack, Buck sets out"}],events:[{start:"00:00:05",end:"00:00:10",size:"quarter",
html:"<h2>Open video project</h2><p>Big Buck Bunny is the lorem ipsum of HTML5 videos, being produced for purposes just like this one.</p>",position:"left"},{start:"00:00:22",end:"00:00:30",size:"quarter",html:"<p>HTML5 video requires that all videos be transcoded into three types, ogg, webm and mp4. Currently there is no standard, though mp4 is useable by all browsers.</p>",position:"right"},{start:"00:00:40",end:"00:00:45",size:"quarter",html:"<h2>Smart video limits</h2><p>Right now, these popups can take ANY html we throw at it -- though we're testing to find the limit.</p>",position:"left"},{start:"00:00:50",end:"00:00:53",size:"quarter",html:"<p>These popups come in three sizes: this size is called 'quarter'",position:"left"},{start:"00:00:53",end:"00:00:56",size:"half",html:"<p>This size is 'half'",position:"right"},{start:"00:00:56",end:"00:00:59",size:"three-quarter",html:"<p>And finally, three-quarter",position:"left"}]})});