String.prototype.compile=function(a){return this.replace(/[{]([^}]+)[}]/g,function(b,c){return a[c]})},function(a){a.fn.smartVideo=function(b){var c,d,e=Object.assign({autoSize:!0,chapters:[],onPlay:!1,onPause:!1,onComplete:!1,mode:"embed"},b),f=this,g=f[0],h={ready:!1,init:function(){f.wrap("<div class='smart-video {mode}'></div>".compile({mode:e.mode})),c=f.closest(".smart-video"),c.prepend("<i class='fa fa-spin fa-cog loader'></i>"),f.removeProp("controls"),f.prop("preload","metadata"),f.attr("playsinline",!0),f.attr("oncontextmenu","return false;"),e.autoSize&&h.resize(),f.after("<div class='control-bar'> <div class='controls'> <a class='fa fa-play'></a> <a class='fa fa-pause hide'></a> </div> <div class='progress'> <div class='inner'></div> </div> <div class='clearfix'></div> </div>"),f.after("<div class='chapter-menu'></div>"),d={play:c.find(".fa-play"),pause:c.find(".fa-pause"),progressBar:c.find(".progress"),progress:c.find(".progress .inner"),chapterMenu:c.find(".chapter-menu")},h.binds()},resize:function(){var a=f.width(),b=.5625*a;f.height(b)},binds:function(){e.autoSize&&a(window).resize(h.resize),d.play.on("click",function(a){a.preventDefault(),h.ready&&g.play()}),d.pause.on("click",function(a){a.preventDefault(),h.ready&&g.pause()}),f.on("loadedmetadata",function(){a.each(e.chapters,function(){var a=this,b=g.duration,c=Math.floor(a.seconds/b*100);d.chapterMenu.append("<a class='chapter' href='#'></a>");var e=d.chapterMenu.find(".chapter").eq(-1);h.getFrame(a.seconds,function(b){d.progressBar.append("<a class='chapter' style='left: {pct}%' data-seconds='{seconds}'><div class='preview'><img src='{thumbnail}' /></div></a>".compile({pct:c,seconds:a.seconds,thumbnail:b})),e.attr("data-seconds",a.seconds).html("<div class='preview'><img src='{thumbnail}' /></div><div class='details'><h2>{title}</h2><p>{desc}</p></div>".compile({seconds:a.seconds,thumbnail:b,title:a.title,desc:a.description}))})}),g.currentTime=0,h.ready=!0,c.addClass("ready")}),f.on("play playing",function(a){d.play.addClass("hide"),d.pause.removeClass("hide"),"function"==typeof e.onPlay&&e.onPlay(a)}),f.on("pause",function(a){d.play.removeClass("hide"),d.pause.addClass("hide"),"function"==typeof e.onPause&&e.onPause(a)}),f.on("timeupdate",function(a){if(h.ready){var b=g.currentTime,c=g.duration,e=Math.floor(b/c*100);d.progress.width(e+"%")}}),f.on("ended",function(a){"function"==typeof e.onComplete&&e.onComplete(a)}),d.progressBar.on("click mousedown mouseup",function(b){b.preventDefault();var c=a(this).offset(),d=b.pageX-c.left,e=a(this).width(),f=d/e,h=g.duration*f;g.currentTime=h}),a("body").on("click",".chapter-menu > a.chapter",function(b){b.preventDefault(),console.log("Click!");var c=a(this),d=c.data("seconds"),e=c.closest(".smart-video"),f=e.find("video")[0];f.currentTime=d,f.play()})},getFrame:function(b,c){var d=document.createElement("canvas"),e=a(g).clone(!1,!1),f=0;e.on("loadedmetadata",function(){d.width=.25*e[0].videoWidth,d.height=.25*e[0].videoHeight,e[0].currentTime=b}),e.on("seeked",function(){d.getContext("2d").drawImage(e[0],0,0,d.width,d.height),f<2?(f++,e[0].currentTime=b):(e.remove(),"function"==typeof c&&c(d.toDataURL()))})}};h.init()}}(jQuery),$(function(){$("video").smartVideo({autoPlay:!0,chapters:[{seconds:5,title:"Chapter 1",description:"Look at the pretty colors!"},{seconds:27,title:"Title Screen",description:"This is where the title finally shows up."}],mode:"fullscreen"})});